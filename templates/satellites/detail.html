<!DOCTYPE html>
{% extends "satellites/base.html" %}
{% block title %} Satellite Details for {{satellite.name}} {% endblock %}
{% block content %}

<h3>{{events | length }} events for {{satellite.name}} between {{t0 | date:"SHORT_DATE_FORMAT"}} and {{t1 | date:"SHORT_DATE_FORMAT"}}</h3>

<table id="details" class="display"></table>

<div id="container" style="width:100%; height:400px;"></div>

{{ events | json_script:'eventdata' }}

<script>

const events = JSON.parse(document.getElementById('eventdata').textContent);

document.addEventListener('DOMContentLoaded', function () {

  $(document).ready(function () {
    $('#details').DataTable({
        data: events.map((x) => { return [
          x.timestamp, x.event,
          Math.round(x.alt*10)/10, Math.round(x.az*10)/10,
          Math.round(x.ra*10)/10, Math.round(x.dec*10)/10,
          x.is_sunlit,
        ]; }),
        columns: [
            { title: 'timestamp' },
            { title: 'event' },
            { title: 'alt' },
            { title: 'az' },
            { title: 'ra' },
            { title: 'dec' },
            { title: 'sunlit?' },
        ],
        ordering: false,
    });
  });

  const chart = Highcharts.chart('container', {
      chart: {
          type: 'spline'
      },
      title: {
        text: 'Peak Altitudes',
      },
      xAxis: {
        title: {
          text: 'Date'
        },
        type: 'datetime'
      },
      yAxis: {
        title: {
          text: 'Altitude (degrees)'
        }
      },
      series:
        [{ name: 'alt',
          data: events
                    .filter((x) => { return x.event == 'peak' })
                    .map((x) => { return [x.timestamp, Math.round(x.alt*10)/10]; })}]
  });
})
</script>

{% endblock %}
